# 功能更新说明

## 更新内容

本次更新为应用添加了以下新功能：

### 1. 测试状态跟踪

#### 1.1 测试通过状态
- 每个词条新增 `testStatus` 字段，包含三个状态：
  - `NOT_TESTED`（未测试）：新增词条的默认状态
  - `FAILED`（未通过）：测试未通过
  - `PASSED`（已通过）：测试通过

#### 1.2 多次测试才通过
- 每个词条新增 `isMultipleAttempts` 字段（布尔值）
- 自动判断逻辑：
  - 如果从"未测试"直接更新为"已通过"：`isMultipleAttempts = false`
  - 如果从"未通过"更新为"已通过"：`isMultipleAttempts = true`
  - 其他情况根据状态变化自动更新

### 2. 错题列表页过滤功能

在错题列表页新增筛选功能，支持按以下条件过滤：

- **题型过滤**：可选择多个题型（注音、书写、释义、辨析、默写、古文释义）
- **测试通过状态过滤**：可选择多个状态（未测试、未通过、已通过）
- **是否多次测试才通过过滤**：可选择"是"、"否"或"全部"

### 3. 智能组卷条件筛选

在试卷生成页面新增组卷条件筛选：

- **测试通过状态筛选**：支持多选（未测试、未通过、已通过）
- **是否多次测试才通过筛选**：可选择"是"、"否"或"全部"

### 4. 批量更新状态功能

- 错题列表页支持多选词条
- 批量更新测试通过状态
- 状态转换规则：
  - 从未测试 → 未通过/已通过 ✅
  - 从未通过 → 未通过/已通过 ✅
  - 已通过 → 未通过 ✅
  - 其他转换 ❌

### 5. 数据库存储

#### 5.1 后端API
- 新增 `/api/words` 端点，支持：
  - `GET`: 获取词条列表（支持过滤）
  - `POST`: 创建新词条
  - `PUT`: 更新词条
  - `PATCH`: 批量更新测试状态
  - `DELETE`: 删除词条

#### 5.2 数据库
- 使用 MySQL 数据库存储数据
- 数据库表：`word_entries`
- 支持 JSON 字段存储复杂数据
- 包含索引优化查询性能

#### 5.3 数据迁移
- 从 localStorage 迁移到 MySQL
- 保留导入/导出功能用于数据备份

## 技术实现

### 新增文件

1. `api/words.js` - 数据库API端点
2. `services/wordService.ts` - 前端API服务层
3. `database/schema.sql` - 数据库表结构
4. `database/README.md` - 数据库配置说明

### 修改文件

1. `types.ts` - 添加新类型定义
2. `App.tsx` - 集成后端API，替换localStorage
3. `components/WordList.tsx` - 添加过滤和批量选择功能
4. `components/ExamGenerator.tsx` - 添加组卷条件筛选
5. `components/WordEntryForm.tsx` - 初始化新状态字段
6. `package.json` - 添加 mysql2 依赖

## 配置要求

### 环境变量

需要在 Vercel 或本地环境配置：

```env
DB_HOST=your-db-host
DB_USER=your-db-user
DB_PASSWORD=your-db-password
DB_NAME=yuwen_cuoti
```

### 数据库初始化

执行以下命令初始化数据库：

```bash
mysql -u root -p < database/schema.sql
```

详细配置说明请参考 `database/README.md`

## 使用说明

### 测试状态管理

1. **单个词条状态更新**：
   - 点击词条卡片上的编辑按钮
   - 在编辑模式下选择测试状态
   - 保存后状态自动更新

2. **批量状态更新**：
   - 在错题列表页勾选多个词条
   - 使用顶部的"批量更新状态"下拉菜单
   - 选择目标状态进行批量更新

### 过滤功能

1. **错题列表过滤**：
   - 点击"筛选"按钮
   - 选择过滤条件
   - 列表自动更新显示符合条件的词条

2. **组卷条件筛选**：
   - 在试卷生成页面点击"组卷条件"
   - 选择筛选条件
   - 试卷内容根据条件自动更新

## 注意事项

1. **数据迁移**：首次使用需要配置数据库连接
2. **状态转换**：系统会自动验证状态转换的合法性
3. **多次测试判断**：系统会根据状态变化自动更新"多次测试才通过"字段
4. **数据备份**：建议定期使用导出功能备份数据

## 后续优化建议

- [ ] 添加状态变更历史记录
- [ ] 支持更复杂的状态转换规则
- [ ] 添加统计分析功能
- [ ] 优化数据库查询性能
- [ ] 添加数据同步功能

